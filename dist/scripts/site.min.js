import d from"/js/domlib.min.js";const app=d.emitter({d:d}),df=d.domfn,{div:div,article:article,textarea:textarea,input:input,a:a,p:p,button:button,hr:hr,h1:h1,h4:h4,section:section,span:span,header:header}=df,reqWithBody=(e="application/json",t=JSON.stringify)=>a=>(n,o,l={})=>fetch(n,{method:a,headers:{"Content-Type":e},body:t(o),...l}),jsonHTTPMethod=reqWithBody(),textHTTPMethod=reqWithBody("text/plain",(e=>e));app.jsonPost=jsonHTTPMethod("POST"),app.jsonPut=jsonHTTPMethod("PUT"),app.jsonDelete=jsonHTTPMethod("DELETE"),app.txtPost=textHTTPMethod("POST"),app.txtPut=textHTTPMethod("PUT"),app.txtDelete=textHTTPMethod("DELETE");const wq=e=>async(t={})=>{isNaN(t.page)&&(t.page=0),t.kind||(t.kind="post");const a=await app.jsonPost(e,t);return await a.json()};app.writQuery=wq("/writs"),app.editableWritQuery=wq("/editable-writs"),app.toggleSituations={list:[],active:null},app.setupToggleSituation=(e,t,a="body",{viewOutAnimation:n,delayRemoveMS:o,background:l}={})=>{const i={};return i.clickOutHandler=d.on.pointerdown(document.body,(a=>{if(a.target!=t&&!t.contains(a.target)&&df.hasClass(t,"open")&&a.target!=e){if(a.path.some((e=>e instanceof Element&&e.classList.contains("toast"))))return;a.preventDefault(),i.toggleView(!1),i.clickOutHandler.off()}})).off(),i.launchEventHandler=d.on.pointerdown(e,(e=>{e.preventDefault(),i.toggleView()})),!0===l&&(l=div.background_cover()),i.toggleView=(s=!df.hasClass(t,"open"))=>{df.class(t,"open",s),df.class(e,"active",s),s?(l&&d.render(l),d.render(t,a),i.clickOutHandler.on(),app.toggleSituations.active&&app.toggleSituations.active.toggleView(!1),app.toggleSituations.active=i):(app.toggleSituations.active==i&&(app.toggleSituations.active=null),null!=o?(t.style.animation=n,i.launchEventHandler.off(),df.remove(t,o).then((()=>{l&&df.remove(l),t.style.animation="",i.launchEventHandler.on()}))):(l&&df.remove(l),df.remove(t)))},app.toggleSituations.list.push(i),i},app.loadScriptsThenRunSequentially=(e,...t)=>new Promise((async(a,n)=>{const o=setTimeout(n,3e3*t.length),l=t[t.length-1];let i="";if(e&&l in localStorage)i=localStorage.getItem(l);else{const a={},n=[];for(const e of t)n.push(fetch(e).then((e=>e.text())).then((t=>{a[e]=t})));await Promise.all(n);for(const e in a)i+="\n;"+a[e];i+=`\n; app.emit("doneLoading:${l}");`,e&&localStorage.setItem(l,i)}app.once["doneLoading:"+l](a),df.script({$:document.head},i),clearTimeout(o)})),app.loadStyle=async(e,t)=>{let a;t&&e in localStorage?a=localStorage.getItem(e):(a=await(await fetch(e)).text(),t&&localStorage.setItem(e,a)),df.style({$:document.head},a)};const abreviateNum_units=["k","M","G","T","P","E","Z","Y"];app.abreviateNum=(e,t)=>{for(let a,n=abreviateNum_units.length-1;n>=0;n--)if(a=Math.pow(1e3,n+1),e<=-a||e>=a)return+(e/a).toFixed(t)+abreviateNum_units[n];return e},app.components={},app.components.toggleBox=(e,{id:t,checked:a,...n}={})=>div.togglebox((o=>o.input=input(d.merge({attr:{name:e,id:t,checked:a,type:"checkbox"}},n))),span()),d.createElementPlugins.contingentVisibility=(e,t)=>{if(d.isArr(e))var[e,a]=e;d.isStr(e)&&app.on["cv:"+e]((e=>{e?t.removeAttribute("hidden"):t.setAttribute("hidden",!0),d.isFunc(a)&&a(e)}))},app.dismissIcon=()=>d.html('<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" style="width: 16px; height: 22px;">\n<polygon fill="rgb(255, 66, 66)" points="11.649 9.882 18.262 3.267 16.495 1.5 9.881 8.114 3.267 1.5 1.5 3.267 8.114 9.883 1.5 16.497 3.267 18.264 9.881 11.65 16.495 18.264 18.262 16.497">\n</polygon>\n</svg>'),app.cv=(e,t)=>{if(app.cv.map[e]==t)return!1;void 0===t&&(t=!app.cv.map[e]),app.emit["cv:"+e](app.cv.map[e]=!!t)},app.cv.check=e=>!!app.cv.map[e],app.cv.map=Object.create(null),app.toastContainer=section.toast_container({$:"body",contingentVisibility:"gotToast"}),app.cv("gotToast",!1),app.toastList=new Set,app.toast=new Proxy(((e,t,a=15e3)=>{app.cv("gotToast",!0);const n=()=>{df.remove(o),app.toastList.delete(o),0==app.toastList.size&&app.cv("gotToast",!1)},o=div.toast[e]({$:app.toastContainer},span(t),span.dismiss_btn({onceclick(){n()}},app.dismissIcon()));return app.toastList.add(o),df.remove(o,a).then(n),o}),{get:(e,t)=>e.bind(null,t)}),d.run((async()=>{try{await app.loadScriptsThenRunSequentially(!0,"https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.10.2/dayjs.min.js","https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.10.2/plugin/utc.min.js","https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.10.2/plugin/relativeTime.min.js"),window.dayjs.extend(window.dayjs_plugin_utc),window.dayjs.extend(window.dayjs_plugin_relativeTime),dayjs().utcOffset(2),app.emit("dayjsLoaded",app.dayjsLoaded=!0)}catch(e){console.error("failed to load dayjs")}})),app.uponDayjsLoaded=e=>e?app.dayjsLoaded?e():app.once.dayjsLoaded(e):app.dayjsLoaded?Promise.resolve(app.dayjsLoaded):new Promise((e=>app.once.dayjsLoaded(e))),app.dateFormat="HH:mm a DD MMM YYYY",app.dayjsUXTSformat=e=>{const t=dayjs.unix(e).utcOffset(2);return t.format(app.dateFormat)+" | "+t.fromNow()},app.renderUXTimestamp=(e,t=app.dayjsUXTSformat,a)=>{null==a&&(a=d.txt());try{a.textContent=t(e),(a.textContent.includes("minute")||a.textContent.includes("hour"))&&(a.updateInterval=setInterval((function n(){a.textContent=t(e),document.contains(a)?a.textContent.includes("hour")&&(clearInterval(a.updateInterval),a.updateInterval=setInterval(n,36e5)):clearInterval(a.updateInterval)}),6e4))}catch(n){a.textContent=new Date(1e3*e).toLocaleString(),app.once.dayjsLoaded((()=>app.renderUXTimestamp(e,t,a)))}return a},app.vote=async(e,t,a)=>{try{const n=await fetch(`/${e}/${t}/${null==a?"unvote":a?"upvote":"downvote"}`);return await n.json()}catch(e){console.error("app.voteWrit error: ",e)}return!1},app.formatVoteCount=(e,t,a=2)=>{e.innerHTML="";let n=app.abreviateNum(t,a);if("string"==typeof n&&n.includes(".")){const e=n[n.length-1];n=n.substring(0,n.length-1);const[t,a]=n.split(".");n=[span(t),".",span.endbits(a),span.marker(e)]}d.render(n,e)},app.votesUI=(e,{id:t,vote:a=0,you_voted:n})=>o=>{const l=div.votes({async onclick(o,l){if(null==app.user){o.preventDefault(),app.oneTimeAuthLauncher&&app.oneTimeAuthLauncher.off();try{app.authViewToggle?app.authViewToggle.toggleView():await import("/js/auth.min.js")}catch(o){app.oneTimeAuthLauncher&&app.oneTimeAuthLauncher.on()}return}const i=o.target.classList.contains("up"),s=o.target.classList.contains("down");if(!s&&!i)return;o.target.classList.add("await-vote"),clearInterval(l.awaitAnimTimeout),l.awaitAnimTimeout=setTimeout((()=>{o.target.classList.remove("await-vote")}),2500);const p=o.target.classList.contains("selected");if(null!=n&&p){const i=await app.vote(e,t);clearInterval(l.awaitAnimTimeout),o.target.classList.remove("await-vote"),0!=i&&(l.downvote.classList.remove("selected"),l.upvote.classList.remove("selected"),app.formatVoteCount(l.voteCount,a=i.data),n=null)}else if(i){const i=await app.vote(e,t,!0);clearInterval(l.awaitAnimTimeout),o.target.classList.remove("await-vote"),0!=i&&(l.downvote.classList.remove("selected"),l.upvote.classList.add("selected"),app.formatVoteCount(l.voteCount,a=i.data),n=!0)}else if(s){const i=await app.vote(e,t,!1);clearInterval(l.awaitAnimTimeout),o.target.classList.remove("await-vote"),0!=i&&(l.upvote.classList.remove("selected"),l.downvote.classList.add("selected"),app.formatVoteCount(l.voteCount,a=i.data),n=!1)}}});return l.append(l.upvote=span({class:{up:!0,vote:!0,selected:!0===n,"icon-up-open":!0}}),l.voteCount=span.vote_count(a),l.downvote=span({class:{down:!0,vote:!0,selected:!1===n,"icon-down-open":!0}})),l},app.filterTagInput=(e,t)=>{if(null==e.data)return t.commas=(t.value.match(/,/g)||[]).length,void(e.lastInput=t.value[t.value.length-1]);const a=t.value.length,n=a?t.value[a-1]:"",o=a?t.value[a-2]:"";if(" "==e.data)if(" "==o)t.value=t.value.slice(0,-1);else if(!a||","!=o&&"-"!=o){if(a&&" "!=o)return void(t.value=t.value.replaceAll(/, /g,",").replaceAll(/  /g,"-").replaceAll(" ","-").replaceAll(",",", "));t.value=t.value.slice(0,-1)+"-"}else a&&(t.value="-"==o?" "==n||","==n?t.value.slice(0,-1):t.value.slice(0,-1).replaceAll(/, /g,",").replaceAll(/  /g,"-").replaceAll(" ","-").replaceAll(",",", "):","==o||" "==n?t.value.slice(0,-1):t.value.replaceAll(/  /g,"-"));else if(","==e.data)","==o||"-"==o?t.value=t.value.slice(0,-1):1==a?t.value="":(t.commas?t.commas++:t.commas=1,t.commas>1?(t.value=[...new Set(t.value.split(",").map((e=>e.trim())).filter((e=>e.length>1&&e.length<23&&-1!==e.search(app.tagRegex))))].join(", ")+", ",t.commas=(t.value.match(/,/g)||[]).length,e.lastInput=t.value[t.value.length-1]):(e.lastInput=e.data,t.value+=" "));else if("-"==e.data){if(1==a)t.value="";else if(","==o||"-"==o||" "==o||" "==n||","==n||"-"==n)return void(t.value=t.value.slice(0,-1))}else e.data.match(/[a-zA-Z0-9]/)||(t.value=app.cleanseTagValue(t.value))},app.cleanseTagValue=e=>{for((e=(e=(e=[...new Set(e.split(",").map((t=>{if((t=t.trim().split("").filter((e=>!!e.match(/[a-zA-Z0-9]/)||!!e.match("-"))).join("")).length&&(""!=t||" "!=t||"\n"!=t)){for(;e.includes("  ");)e=e.replaceAll(/  /g,"-");for(;e.includes("--");)e=e.replaceAll(/--/g,"-");for(;"-"==t[0]||" "==t[0]||","==t[0];)t=t.slice(1);for(;"-"==t[t.length-1]||" "==t[t.length-1]||","==t[t.length-1];)t=t.slice(0,-1)}return t})).filter((e=>e.length<23&&""!=e&&" "!=e&&"\n"!=e)))].join(", ")).split("").filter(((e,t)=>!!e.match(/[a-zA-Z0-9]/)||!(!e.match("-")||0==t&&t==len-1)||!(!e.match(",")||0==t&&t==len-1))).join("").replaceAll("\n","").replaceAll(/, /g,",").replaceAll(/  /g,"-").replaceAll(" ","-").replaceAll(/--/g,"-").replaceAll(/---/g,"-").replaceAll(",",", ")).replace(/-$/g,"")).includes("-,")&&(e=e.replaceAll(/,-/g,","));e.includes("--");)e=e.replaceAll(/--/g,"-");for(;e.includes(",,");)e=e.replaceAll(/,,/g,",");for(;e.includes(", , ");)e=e.replaceAll(/, , /g,", ");for(;e.includes("  ");)e=e.replaceAll(/,,/g,",");return e.length?e:""},app.tagRegex=/^[a-zA-Z0-9-]+$/,app.tabView=({$:e,tabs:t=[],attacher:a="after",...n})=>{const o=header({onclick(e){e.target.classList.contains("tab-name")&&!e.target.classList.contains("active")&&i&&(i.name.classList.remove("active"),i=l[e.target.textContent],i.name.classList.add("active"),s.innerHTML="",d.render(i.view,s))}}),l=Object.create(null);t.map((({name:e,view:t})=>{l[e]={name:div.tab_name(e),view:t},o.append(l[e].name)}));let i=l[t[0].name];i.name.classList.add("active");const s=div(i.view),p=article.tab_view(n,o,s);return e&&d.render(p,e,a),{element:p,get tabs(){return t},get views(){return l},add(e,a){t.push({name:e,view:a}),l[e]={name:div.tab_name({$:o},e),view:a}},remove(e){t=t.filter((t=>t.name!=e)),df.remove(l[e].name),delete l[e]},set active(e){l[e]&&(i.name.classList.remove("active"),i=l[e],i.name.classList.add("active"),s.innerHTML="",d.render(i.view,s))},get active(){return i}}};const isURL=e=>{try{return new URL(e),!0}catch(e){}return!1};window.app=app;export default app;
//# sourceMappingURL=site.min.js.map